/* 
 * @version 1.0
 * @copyright ConVista
 * @author Martin Pankraz
 *
 * @classdesc UI5 Timeline Plugin for SAP Design Studio 
 *
 *
 */
var libPath="../"+sap.zen.createStaticSdkMimeUrl("com.convista.chat","res/js/");define(["css!../js/css/myChat.css"],function(){var that=null;jQuery.sap.require("sap.suite.ui.commons.Timeline"),jQuery.sap.require("sap.ui.core.format.DateFormat"),sap.ui.commons.layout.AbsoluteLayout.extend("com.convista.chat.UI5Chat",{metadata:{properties:{DMessages:{type:"array"},DMessageAddTrigger:{type:"boolean"},DBackendMessageID:{type:"String"},DReplyMessage:{type:"String"},DEnableSocial:{type:"boolean"},DDatePattern:{type:"String"},DDateStyle:{type:"String"}}},initDesignStudio:function(){that=this,this.addStyleClass("heightOverride"),this.layoutInitialized=!1,this.oModel=new sap.ui.model.json.JSONModel,this.setModel(this.oModel),sap.ui.getCore().setModel(this.oModel),this._timeline=new sap.suite.ui.commons.Timeline(this.getId()+"_time",{alignment:sap.suite.ui.commons.TimelineAlignment.Right,axisOrientation:sap.suite.ui.commons.TimelineAxisOrientation.Vertical,showHeaderBar:!1,enableAllInFilterItem:!0,enableScroll:!0,noDataText:"no input found!",height:"100%"});var timelineitem=new sap.suite.ui.commons.TimelineItem({dateTime:"{dateTime}",userName:"{userName}",title:"{title}",text:"{text}",icon:"sap-icon://notes",filterValue:"Note",userNameClickable:!1,userPicture:"{userPicture}",iconTooltip:"my icon tooltip",selected:"{selected}"}).addStyleClass("cc-chat-layout");this._timeline.bindAggregation("content","/records",timelineitem),timelineitem.attachReplyPost(that.onReply),this.addContent(that._timeline,{left:"0px",top:"0px"}),this._timeline.attachAddPost(that.onAddPost),this._timeline.attachSelect(that.onSelect)},onAfterRendering:function(){var records=this.oModel.oData.records;if(records)for(var i=0;i<records.length;i++){var obj=records[i],selector='li[id*="control_time-'+i+'"]',box=selector+' div[class*="sapSuiteUiCommonsTimelineItemBox"]',arrow=selector+' div[class="sapSuiteUiCommonsTimelineItemArrow"]';"High"===obj.priority?($(box).addClass("myMessagePriorityHigh"),$(arrow).css("border-bottom-color","#e52929").css("border-left-color","#e52929")):"Medium"===obj.priority?($(box).addClass("myMessagePriorityMedium"),$(arrow).css("border-bottom-color","#008a3b").css("border-left-color","#008a3b")):"Low"===obj.priority?($(box).addClass("myMessagePriorityLow"),$(arrow).css("border-bottom-color","#f0ab00").css("border-left-color","#f0ab00")):($(box).addClass("myMessagePriorityNone"),$(arrow).css("border-bottom-color","#007cc0").css("border-left-color","#007cc0")),obj.selected?($(box).addClass("myMessageActive"),$(arrow).addClass("myArrowActive")):($(box).removeClass("myMessageActive"),$(arrow).removeClass("myArrowActive"))}},renderer:{},afterDesignStudioUpdate:function(){if(that=this,that.layoutInitialized||(this._timeline.setEnableSocial(this.getDEnableSocial()),that._datePattern=this.getDDatePattern(),that._dateStyle=this.getDDateStyle()),this.getDMessageAddTrigger()===!0||!that.layoutInitialized){for(var messages=this.getDMessages()||[],result=[],i=0;i<messages.length;i++){var date="";date=""===that._datePattern?this.getDateStringFromValue(messages[i].datetime):messages[i].datetime;var ts=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:that._datePattern}).parse(date);date=sap.ui.core.format.DateFormat.getDateTimeInstance({style:that._dateStyle}).format(ts),result.push({myId:messages[i].myId,text:messages[i].text,title:messages[i].title,icon:"sap-icon://notes",dateTime:date,userName:messages[i].user,filterValue:"Note",userNameClickable:!1,userPicture:messages[i].picture,iconTooltip:"my icon tooltip",priority:messages[i].priority,selected:!1,chatId:messages[i].chatId})}var isInDesignMode=void 0!==sap.zen.designmode;this.oModel.setData(isInDesignMode?this.getExampleData():{records:result}),this.setDMessageAddTrigger(!1),this.fireDesignStudioPropertiesChanged(["DMessageAddTrigger"]),that.layoutInitialized=!0}},onAddPost:function(){},onSelect:function(oEvent){var params=oEvent.getParameters(),item=params.selectedItem,path=(item.sId,item.getBindingContext().getPath()),obj=that.getModel().getProperty(path),records=that.oModel.oData.records;if(records)for(var i=0;i<records.length;i++){var record=records[i];record.selected=record.myId===obj.myId?!0:!1}that.setDBackendMessageID(obj.myId),that.fireDesignStudioPropertiesChangedAndEvent(["DBackendMessageID"],"onCloseClicked")},onReply:function(oEvent){var params=oEvent.getParameters();that.setDReplyMessage(params.value),that.fireDesignStudioPropertiesChangedAndEvent(["DReplyMessage"],"onReplyClicked")},getExampleData:function(){var oData={records:[{dateTime:"Date(1407049200000)",userName:"John Smith",title:"added a note",text:"sample text for a Note type item",icon:"sap-icon://notes",filterValue:"Note",userNameClickable:!0,userPicture:"aad/"+libPath+"css/Woman_04.png",replyCount:0,maxCharacters:240,iconTooltip:"my icon tooltip",priority:"High",selected:!0},{dateTime:"Date(1407049200000)",userName:"No one",title:"added a note",text:"sample text for a Note type item",icon:"sap-icon://notes",filterValue:"Note",userNameClickable:!0,userPicture:"aad/"+libPath+"css/Woman_04.png",replyCount:0,maxCharacters:240,iconTooltip:"my icon tooltip",priority:"Low",selected:!1},{dateTime:"Date(1407049200000)",userName:"John Smith again",title:"added a note",text:"sample text for a Note type item",icon:"sap-icon://notes",filterValue:"Note",userNameClickable:!0,userPicture:"aad/"+libPath+"css/Woman_04.png",replyCount:0,maxCharacters:240,iconTooltip:"my icon tooltip",priority:"Medium",selected:!1},{dateTime:"Date(1407049200000)",userName:"John Smith again and again",title:"added a note",text:"sample text for a Note type item",icon:"sap-icon://notes",filterValue:"Note",userNameClickable:!0,userPicture:"aad/"+libPath+"css/Woman_04.png",replyCount:0,maxCharacters:240,iconTooltip:"my icon tooltip",priority:"None",selected:!1}]};return oData},getDateStringFromValue:function(date_string){var date=new Date(date_string);return date.toLocaleDateString()+" "+date.toLocaleTimeString()}})});