/* 
 * @version 1.0
 * @copyright ConVista
 * @author Martin Pankraz
 *
 * @classdesc UI5 Notification Item List Plugin for SAP Design Studio 
 *
 *
 */
var libPathChat="../"+sap.zen.createStaticSdkMimeUrl("com.convista.chat","res/js/");define(["css!../js/css/myChat.css"],function(){var that=null;jQuery.sap.require("sap.ui.core.format.DateFormat"),sap.m.List.extend("com.convista.chat.UI5Chat",{metadata:{properties:{DMessages:{type:"array"},DMessageAddTrigger:{type:"boolean"},DBackendMessageID:{type:"String"},DReplyMessage:{type:"String"},DDatePattern:{type:"String"},DDateStyle:{type:"String"}}},initDesignStudio:function(){that=this,this.layoutInitialized=!1,this.oModel=new sap.ui.model.json.JSONModel,this.setModel(this.oModel),sap.ui.getCore().setModel(this.oModel);var notiflistitem=new sap.m.NotificationListItem({description:"{description}",truncate:"{truncate}",hideShowMoreButton:"{hideShowMoreButton}",priority:"{priority}",title:"{title}",datetime:"{datetime}",showButtons:"{showButtons}",showCloseButton:"{showCloseButton}",authorName:"{authorName}",tooltip:"{tooltip}",authorPicture:"{authorPicture}"}).addStyleClass("descriptionStyle");notiflistitem.attachClose(that.onClose),this.bindAggregation("items","/records",notiflistitem)},onAfterRendering:function(){},renderer:{},afterDesignStudioUpdate:function(){if(that=this,that.layoutInitialized||(that._datePattern=this.getDDatePattern(),that._dateStyle=this.getDDateStyle()),this.getDMessageAddTrigger()===!0||!that.layoutInitialized){for(var messages=this.getDMessages()||[],result=[],i=0;i<messages.length;i++){var date="";date=""===that._datePattern?this.getDateStringFromValue(messages[i].datetime):messages[i].datetime;var ts=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:that._datePattern}).parse(date);date=sap.ui.core.format.DateFormat.getDateTimeInstance({style:that._dateStyle}).format(ts),result.push({myId:messages[i].myId,description:messages[i].text,truncate:!0,hideShowMoreButton:!1,priority:messages[i].priority,title:messages[i].title,datetime:date,showButtons:!0,showCloseButton:!0,authorName:messages[i].user,authorPicture:messages[i].picture,chatId:this.getDChatIdentifier()})}var isInDesignMode=void 0!==sap.zen.designmode;this.oModel.setData(isInDesignMode?this.getExampleData():{records:result}),this.setDMessageAddTrigger(!1),this.fireDesignStudioPropertiesChanged(["DMessageAddTrigger"]),that.layoutInitialized=!0}},onAddPost:function(){},onClose:function(oEvent){var me=oEvent.getSource(),path=me.getBindingContext().getPath(),obj=that.getModel().getProperty(path);that.setDBackendMessageID(obj.myId),that.fireDesignStudioPropertiesChangedAndEvent(["DBackendMessageID"],"onCloseClicked")},flattenFormattedData:function(){var result=[],isInDesignMode=void 0!==sap.zen.designmode;if(isInDesignMode)return this.getExampleData();this.getData();return result},getExampleData:function(){var oData={records:[{description:"Apple",truncate:!0,hideShowMoreButton:!1,priority:"None",title:"Some Title",datetime:"1 Aug 2016",showButtons:!0,showCloseButton:!0,authorName:"Martin",tooltip:"Apple None",authorPicture:"aad/"+libPathChat+"css/Woman_04.png"},{description:"Banana",truncate:!1,hideShowMoreButton:!1,priority:"High",title:"Some Title",datetime:"2 Aug 2016",showButtons:!1,showCloseButton:!1,authorName:"Martin",tooltip:"Banana High",authorPicture:"aad/"+libPathChat+"css/Woman_04.png"},{description:"Carrot",truncate:!0,hideShowMoreButton:!1,priority:"Low",title:"Some Title",datetime:"3 Aug 2016",showButtons:!1,showCloseButton:!0,authorName:"Martin",tooltip:"Carrot Low",authorPicture:"aad/"+libPathChat+"css/Woman_04.png"},{description:"Capsicum ver lasdmvsdvisjdvsdvnascnsdiovjiosdvjsdiovjidnv",truncate:!0,hideShowMoreButton:!1,priority:"Medium",title:"Some Title",datetime:"4 Aug 2016",showButtons:!0,showCloseButton:!1,authorName:"Martin",tooltip:"Capsicum Medium",authorPicture:"aad/"+libPathChat+"css/Woman_04.png"}]};return oData},getDateStringFromValue:function(date_string){var date=new Date(date_string);return date.toLocaleDateString()+" "+date.toLocaleTimeString()}})});