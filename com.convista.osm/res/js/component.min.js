!function(){var myScript=$("script:last")[0].src;""===myScript&&(myScript="/aad/zen/mimes/sdk_include/com.convista.osm/res/js/"),sap.zen.Dispatcher.instance.pauseDispatching();var sdkReqs=require.config({context:"sdk",paths:{leaflet:myScript.substring(0,myScript.indexOf("js/"))+"js/leaflet",prv:myScript.substring(0,myScript.indexOf("js/"))+"js/leaflet-providers.min",label:myScript.substring(0,myScript.indexOf("js/"))+"js/leaflet.label",cluster:myScript.substring(0,myScript.indexOf("js/"))+"js/leaflet.markercluster",numeral:myScript.substring(0,myScript.indexOf("js/"))+"js/numeral.min",eBtn:myScript.substring(0,myScript.indexOf("js/"))+"js/easy-button.min",fBtn:myScript.substring(0,myScript.indexOf("js/"))+"js/FunctionButton.min"},shim:{prv:{deps:["leaflet"]},label:{deps:["leaflet"]},cluster:{deps:["leaflet"]},eBtn:{deps:["leaflet"]},fBtn:{deps:["leaflet"]}},rlArgs:"v=20140515"});sdkReqs(["require","leaflet","prv","label","cluster","numeral","eBtn","fBtn"],function(require,L){sap.designstudio.sdk.Component.subclass("com.convista.osm.DataMap",function(){function initMap(callback){window.initializeGmaps=function(){if(that.geocoder=new google.maps.Geocoder,that.map=L.map(that.$()[0]).setView([DEFAULT_LATITUDE,DEFAULT_LONGITUDE],8),void 0!==typeof Storage&&void 0!==sessionStorage.omap_center_stored&&void 0!==sessionStorage.omap_zoom_stored){var center_saved=JSON.parse(sessionStorage.omap_center_stored);if(isFloat(center_saved.lat)===!0&&isFloat(center_saved.lng)===!0){var latlng=new L.LatLng(center_saved.lat,center_saved.lng);that.map.setView(latlng,parseInt(sessionStorage.omap_zoom_stored,10))}}that.markerClusterer=new L.MarkerClusterGroup({iconCreateFunction:function(cluster){return myIconCreate(cluster)},spiderfyOnMaxZoom:!1,showCoverageOnHover:!0,zoomToBoundsOnClick:!1}),that.markersArray=[],that.markerClusterer.on("clusterclick",function(a){myClusterClick(a)}),that.markerClusterer.on("clustermouseover",function(a){myClusterHover(a)});var defaultLayer=L.tileLayer.provider("OpenStreetMap.DE").addTo(that.map),overlayLayers={OpenSeaMap:L.tileLayer.provider("OpenSeaMap"),"OpenWeatherMap Clouds":L.tileLayer.provider("OpenWeatherMap.Clouds"),"OpenWeatherMap PrecipitationClassic":L.tileLayer.provider("OpenWeatherMap.PrecipitationClassic"),"OpenWeatherMap RainClassic":L.tileLayer.provider("OpenWeatherMap.RainClassic"),"OpenWeatherMap PressureContour":L.tileLayer.provider("OpenWeatherMap.PressureContour"),"OpenWeatherMap Wind":L.tileLayer.provider("OpenWeatherMap.Wind"),"OpenWeatherMap Temperature":L.tileLayer.provider("OpenWeatherMap.Temperature"),"OpenWeatherMap Snow":L.tileLayer.provider("OpenWeatherMap.Snow")},baseLayers={"OpenStreetMap Default":defaultLayer,"OpenStreetMap German Style":L.tileLayer.provider("OpenStreetMap.DE"),"OpenStreetMap Black and White":L.tileLayer.provider("OpenStreetMap.BlackAndWhite"),"MapQuest OSM":L.tileLayer.provider("MapQuestOpen.OSM"),"MapQuest Aerial":L.tileLayer.provider("MapQuestOpen.Aerial"),"MapBox Example":L.tileLayer.provider("MapBox.examples.map-zr0njcqy"),"Stamen Terrain":L.tileLayer.provider("Stamen.Terrain"),"Esri WorldStreetMap":L.tileLayer.provider("Esri.WorldStreetMap"),"Esri DeLorme":L.tileLayer.provider("Esri.DeLorme"),"Esri WorldTopoMap":L.tileLayer.provider("Esri.WorldTopoMap"),"Esri WorldImagery":L.tileLayer.provider("Esri.WorldImagery")};that.layerControl=L.control.layers(baseLayers,overlayLayers,{collapsed:!0}).addTo(that.map),keyfigureButtonClicked=!0;var bt_label="-1-";that.keyfiguretodisplay()===saveKeyFigureName1?bt_label="-1-":that.keyfiguretodisplay()===saveKeyFigureName2&&(bt_label="-2-"),that.funcBtn=L.functionButtons([{content:bt_label,title:"Click to switch keyfigure to show on clusters"}]),that.funcBtn.on("clicked",function(data){if(0==data.idx){var figure2_not_defined=!1;if(that.markerClusterer.eachLayer(function(layer){keyfigureButtonClicked===!1&&null!==saveKeyFigureName1?(layer.updateLabelContent(""+layer.keyfigure1),layer.activeKeyfigure=0,that.funcBtn.setContent("-1-"),that.keyfiguretodisplay(saveKeyFigureName1),that.firePropertiesChanged(["keyfiguretodisplay"])):keyfigureButtonClicked===!0&&""!==saveKeyFigureName2?(layer.updateLabelContent(""+layer.keyfigure2),layer.activeKeyfigure=1,that.funcBtn.setContent("-2-"),that.keyfiguretodisplay(saveKeyFigureName2),that.firePropertiesChanged(["keyfiguretodisplay"])):figure2_not_defined=!0}),figure2_not_defined)window.console&&console.log("Keyfigures cannot be switched due to input errors. Probably Keyfigure 2 is not defined!");else{keyfigureButtonClicked=!keyfigureButtonClicked;var clusters=that.markerClusterer.getLayers();that.markerClusterer.removeLayers(that.markerClusterer.getLayers()),that.markerClusterer.addLayers(clusters)}}}),that.map.addControl(that.funcBtn),L.easyButton("fa-plus-square",function(){that.markerClusterer.addLayers(that.markersArray)},"Click to show all markers again",that.map),that.$(document).ready(function(){setTimeout(function(){if(that.map.invalidateSize(!1),void 0!==typeof Storage&&void 0!==sessionStorage.omap_center_stored&&void 0!==sessionStorage.omap_zoom_stored){var center_saved=JSON.parse(sessionStorage.omap_center_stored);if(isFloat(center_saved.lat)===!0&&isFloat(center_saved.lng)===!0){var latlng=new L.LatLng(center_saved.lat,center_saved.lng);that.map.setView(latlng,parseInt(sessionStorage.omap_zoom_stored,10))}}else{var c=that.map.getCenter(),z=that.map.getZoom();that.map.setView(c,z)}},100)}),that.map.on("dragend",function(){void 0!==typeof Storage?(sessionStorage.omap_center_stored=JSON.stringify(that.map.getCenter()),sessionStorage.omap_zoom_stored=that.map.getZoom()):window.console&&console.log("Web browser storage type undefined. Please use a different one.")}),that.map.on("zoomend",function(){void 0!==typeof Storage?sessionStorage.omap_zoom_stored=that.map.getZoom():window.console&&console.log("Web browser storage type undefined. Please use a different one.")}),callback()},saveApiLoad===!0?($(document).ready(function(){$("head").append('<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key='+saveAPIKey+'&libraries=weather,drawing&sensor=false&callback=initializeGmaps"></script>')}),that.apiload(!1),that.firePropertiesChanged(["apiload"])):initializeGmaps()}function initData(){if(runtime_data){for(var dim=null,id=null,address=null,marker_text=null,date=null,keyfigure2_array=[],keyfigure2=0,keyfigure1_array=[],keyfigure1=0,keyfigure2_array_diff=[],keyfigure2_diff=0,keyfigure1_array_diff=[],keyfigure1_diff=0,iter_step=0,notif_position_in_dimensions_array=0,l=0;l<runtime_data.dimensions.length;l++)if(dim=runtime_data.dimensions[l],dim.containsMeasures===!0){iter_step=dim.members.length;for(var i=0;i<dim.members.length;i++)if(dim.members[i].text===saveKeyFigureName1){var format=parseNumberFormatString(dim.members[i].formatString);keyfigureFormatStrings.figure1=""===format?"0":format}else if(dim.members[i].text===saveKeyFigureName2){var format=parseNumberFormatString(dim.members[i].formatString);keyfigureFormatStrings.figure2=""===format?"0":format}}else dim.key===saveTextDimension&&(notif_position_in_dimensions_array=l);for(var tuples_grouped_by_rowKey=[],i=0,current_row_key_index=runtime_data.tuples[0][notif_position_in_dimensions_array],current_tuples_to_group=new Array;i<runtime_data.tuples.length;){var tuple=runtime_data.tuples[i];if(tuple[notif_position_in_dimensions_array]===current_row_key_index){var row=runtime_data.dimensions[1].members[tuple[1]].type;"RESULT"!==row&&current_tuples_to_group.push(tuple)}else tuples_grouped_by_rowKey.push(current_tuples_to_group),current_tuples_to_group=new Array,current_tuples_to_group.push(tuple),current_row_key_index=tuple[notif_position_in_dimensions_array];i===runtime_data.tuples.length-1&&tuples_grouped_by_rowKey.push(current_tuples_to_group),i++}for(var data_pointer=-iter_step,l=0;l<tuples_grouped_by_rowKey.length;l++){for(var i=0;i<tuples_grouped_by_rowKey[l].length;i+=iter_step){var tuple=tuples_grouped_by_rowKey[l][i];data_pointer+=iter_step;for(var j=0;j<tuple.length;j++)if(dim=runtime_data.dimensions[j],dim.key===saveAddressDimension)address=dim.members[tuple[j]].text;else if(dim.key===saveTextDimension)id=dim.members[tuple[j]].key,marker_text=dim.members[tuple[j]].text;else if(dim.key===saveDateDimension)date=dim.members[tuple[j]].text;else if(dim.containsMeasures===!0)for(var k=0;k<dim.members.length;k++){var index=data_pointer+k,data="";dim.members[k].text===saveKeyFigureName1?null===runtime_data.data[index]||""===runtime_data.data[index]?(data=isFloat(keyfigureFormatStrings.figure1)?parseFloat("0.00").toFixed(4):"0",keyfigure1_array.push(data)):keyfigure1_array.push(runtime_data.data[index]):dim.members[k].text===saveKeyFigureName2?null===runtime_data.data[index]||""===runtime_data.data[index]?(data=isFloat(keyfigureFormatStrings.figure2)?parseFloat("0.00").toFixed(4):"0",keyfigure2_array.push(data)):keyfigure2_array.push(runtime_data.data[index]):dim.members[k].text===saveKeyFigureName1Diff?null===runtime_data.data[index]||""===runtime_data.data[index]?(data=isFloat(keyfigureFormatStrings.figure1)?parseFloat("0.00").toFixed(4):"0",keyfigure1_array_diff.push(data)):keyfigure1_array_diff.push(runtime_data.data[index]):dim.members[k].text===saveKeyFigureName2Diff&&(null===runtime_data.data[index]||""===runtime_data.data[index]?(data=isFloat(keyfigureFormatStrings.figure2)?parseFloat("0.00").toFixed(4):"0",keyfigure2_array_diff.push(data)):keyfigure2_array_diff.push(runtime_data.data[index]))}}for(var m=0;m<keyfigure1_array.length;m++)isInt(keyfigureFormatStrings.figure1)?(keyfigure1+=parseInt(keyfigure1_array[m],10),keyfigure1_diff+=parseInt(keyfigure1_array_diff[m],10)):(keyfigure1+=parseFloat(keyfigure1_array[m]),keyfigure1_diff+=parseFloat(keyfigure1_array_diff[m])),isInt(keyfigureFormatStrings.figure2)?(keyfigure2+=parseInt(keyfigure2_array[m],10),keyfigure2_diff+=parseInt(keyfigure2_array_diff[m],10)):(keyfigure2+=parseFloat(keyfigure2_array[m]),keyfigure2_diff+=parseFloat(keyfigure2_array_diff[m]));if(!(address&&id&&marker_text&&date))return void alert("There is a dimension data read error. Probably you didn't specify all necessary dimensions. Please review settings in Design Studio.");var doc=findInAddressDatabase(address);if(null!==doc&&void 0!==doc){var loc=[doc.geometry.coordinates[0],doc.geometry.coordinates[1]];createMarker(address,[keyfigure1,keyfigure2,keyfigure1_diff,keyfigure2_diff],marker_text,loc,date,id)}else geocodeMarker(address,[keyfigure1,keyfigure2,keyfigure1_diff,keyfigure2_diff],marker_text,date,id);keyfigure1_array=[],keyfigure1_array_diff=[],keyfigure2_array=[],keyfigure2_array_diff=[],keyfigure1=0,keyfigure1_diff=0,keyfigure2=0,keyfigure2_diff=0}that.markerClusterer.addLayers(that.markersArray),that.map.addLayer(that.markerClusterer)}}function geocodeMarker(addressObject,key_figure,text,date,id){setTimeout(function(){that.geocoder.geocode({address:addressObject},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(key_figure){var loc=[results[0].geometry.location.lat(),results[0].geometry.location.lng()],marker=createMarker(addressObject,key_figure,text,loc,date,id);that.markerClusterer.addLayer(marker)}updateAddressDatabase(addressObject,results[0].geometry.location)}else window.console&&console.log("Geocode failed for the following reason: "+status+"\n"+addressObject)})},2e3*Math.random()*2e3)}function createMarker(address,key_figure_array,text,position,date,id){var marker=new L.Marker(position);return marker.bindLabel(" "+key_figure_array[0]+" ",{noHide:!0,direction:"auto"}),marker.id=id,marker.address=address,marker.date=date,marker.keyfigure1=key_figure_array[0],marker.diff1=key_figure_array[2],marker.keyfigure2=key_figure_array[1],marker.diff2=key_figure_array[3],marker.activeKeyfigure=that.keyfiguretodisplay()===saveKeyFigureName1?0:that.keyfiguretodisplay()===saveKeyFigureName2?1:0,attachPopupDetailsToMarker(marker,text),that.markersArray.push(marker),marker.showLabel(),marker}function attachPopupDetailsToMarker(marker,detailsText){var content="<div><h1>Info</h1><p>"+detailsText+"</p></div>";marker.bindPopup(content),marker.on("click",function(marker){that.address(marker.address),that.firePropertiesChanged(["address"]),that.fireEvent("onMarkerClicked")})}function findInAddressDatabase(address){var result=null;if(address=address.toUpperCase(),ALL_ADDRESSES)for(var i=0;i<ALL_ADDRESSES.length;i++)if(ALL_ADDRESSES[i].properties.name.toUpperCase()===address){result=ALL_ADDRESSES[i];break}return result}function updateAddressDatabase(addressObject,location){var data={type:"Feature",geometry:{type:"Point",coordinates:[location.lat(),location.lng()]},properties:{name:addressObject}};if(null!==DB_URL&&void 0!==DB_URL&&""!==DB_URL)$.ajax({type:"POST",url:DB_URL,data:JSON.stringify(data),contentType:"application/json",error:function(e){window.console&&console.log(e.message)}});else{var addressObjectStore=DB.transaction(STORE_NAME,"readwrite").objectStore(STORE_NAME),request=addressObjectStore.add(data);request.onerror=function(){console.log("Wasn't able to complete adding address to db")}}}function convertDateToInternalSAP(date_string){var date=date_string.split("."),dd=date[0],mm=date[1],yyyy=date[2];return yyyy+""+mm+dd}function parseNumberFormatString(keyfigureFormatString){var part_without_minus_operator=keyfigureFormatString.split(";")[0];return part_without_minus_operator.replace(new RegExp("#","g"),"0")}function isInt(value){var result=null,int_regex=/^-?[0-9]$/,int_regex_string=/^"-?[0-9]"$/;return result=int_regex.test(value)?!0:int_regex_string.test(value)?!0:!1}function isFloat(value){var result=null,float_regex=/^-?[0-9]+\.?[0-9]+\,?[0-9]+$/,float_regex_string=/^"-?[0-9]+\.?[0-9]+,[0-9]+"$/;return result=float_regex.test(value)?!0:float_regex_string.test(value)?!0:!1}function myClusterClick(cluster){for(var address=[],date=[],id=[],markers=cluster.layer.getAllChildMarkers(),i=0;i<markers.length;i++){var marker=markers[i];address.push(marker.address),date.push(convertDateToInternalSAP(marker.date)),id.push(marker.id)}var address_json='"'+saveAddressDimension+'": '+JSON.stringify(address),date_json='"'+saveDateDimension+'":'+JSON.stringify(date),id_json='"'+saveTextDimension+'":'+JSON.stringify(id),transport="{"+id_json+","+address_json+","+date_json+"}";that.clusterselection(transport),that.addressselection(address_json),that.dateselection(date_json),that.idselection(id_json),that.firePropertiesChanged(["clusterselection","addressselection","dateselection","idselection"]),that.fireEvent("onClusterClick"),that.markerClusterer.removeLayers(that.markersArray),that.markerClusterer.addLayers(markers)}function myClusterHover(cluster){that.map.getMaxZoom()===that.map.getZoom()&&cluster.layer.spiderfy()}function myIconCreate(cluster){var markers=cluster.getAllChildMarkers(),n=0,n_diff=0,keyfigure_diff=0,step1=0,step2=0,step3=0,step4=0,format_string="",figure_format="";if(0===markers[0].activeKeyfigure?figure_format=keyfigureFormatStrings.figure1:1===markers[0].activeKeyfigure&&(figure_format=keyfigureFormatStrings.figure2),isInt(figure_format))for(var i=0;i<markers.length;i++)0===markers[0].activeKeyfigure?(n+=parseInt(markers[i].keyfigure1,10),n_diff+=parseInt(markers[i].diff1,10)):1===markers[0].activeKeyfigure?(n+=parseInt(markers[i].keyfigure2,10),n_diff+=parseInt(markers[i].diff2,10)):window.console&&console.log("Active keyfigure 0 number not supported!");else if(isFloat(figure_format))for(var i=0;i<markers.length;i++)0===markers[0].activeKeyfigure?(n+=parseFloat(markers[i].keyfigure1),n_diff+=parseFloat(markers[i].diff1)):1===markers[0].activeKeyfigure?(n+=parseFloat(markers[i].keyfigure2),n_diff+=parseFloat(markers[i].diff2)):window.console&&console.log("Active keyfigure 1 number not supported!");else window.console&&console.log("Marker content to display not supported. Only use int or float!");0===markers[0].activeKeyfigure&&""!==saveKeyFigureName1ClusterSteps?(step1=saveKeyFigureName1ClusterSteps[0],step2=saveKeyFigureName1ClusterSteps[1],step3=saveKeyFigureName1ClusterSteps[2],step4=saveKeyFigureName1ClusterSteps[3]):1===markers[0].activeKeyfigure&&""!==saveKeyFigureName2ClusterSteps&&(step1=saveKeyFigureName2ClusterSteps[0],step2=saveKeyFigureName2ClusterSteps[1],step3=saveKeyFigureName2ClusterSteps[2],step4=saveKeyFigureName2ClusterSteps[3]),format_string="0 a";var c=" marker-cluster-";c+=step1>=n?"1":step2>=n?"2":step3>=n?"3":step4>=n?"4":"5",keyfigure_diff=(n-n_diff)/n,n=numeral(n).format(format_string);var icon=null;return icon=L.divIcon(keyfigure_diff>=saveKeyFigureTolerance?{html:'<div data-content="'+numeral(keyfigure_diff).format("+0.00")+'"><span>'+n+"</span></div>",className:"marker-cluster marker-cluster-"+c+" arrow-up",iconSize:new L.Point(60,60)}:-saveKeyFigureTolerance>=keyfigure_diff?{html:'<div data-content="'+numeral(keyfigure_diff).format("+0.00")+'"><span>'+n+"</span></div>",className:"marker-cluster marker-cluster-"+c+" arrow-down",iconSize:new L.Point(60,60)}:{html:"<div><span>"+n+"</span></div>",className:"marker-cluster marker-cluster-"+c,iconSize:new L.Point(60,60)})}function openAddressDatabase(callback){if(window.indexedDB){var openRequest=indexedDB.open(DB_NAME,1);openRequest.onerror=function(e){window.console&&(console.log("Error opening addresses db"),console.dir(e))},openRequest.onupgradeneeded=function(e){DB=e.target.result,DB.objectStoreNames.contains(STORE_NAME)||(console.log("create the addresses and settings objectstore"),OBJECT_STORE=DB.createObjectStore(STORE_NAME,{autoIncrement:!0}))},openRequest.onsuccess=function(e){DB=e.target.result,DB.onerror=function(event){alert("Database error: "+event.target.errorCode),window.console&&console.dir(event.target)},callback()}}else window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.")}function getAllItems(callback){var transactionType={READ_ONLY:"readonly",READ_WRITE:"readwrite"};IDBTransaction.READ_ONLY&&IDBTransaction.READ_WRITE&&(transactionType.READ_ONLY=IDBTransaction.READ_ONLY,transactionType.READ_WRITE=IDBTransaction.READ_WRITE);var trans=DB.transaction(STORE_NAME,transactionType.READ_ONLY),store=trans.objectStore(STORE_NAME),cursorRequest=store.openCursor();cursorRequest.onerror=function(error){window.console&&console.log(error)},cursorRequest.onsuccess=function(evt){var cursor=evt.target.result;cursor&&(ALL_ADDRESSES.push(cursor.value),eval("cursor.continue()"))},trans.oncomplete=function(){callback()}}var DB_URL=null,DB_URL_EXTENSION=null,OBJECT_STORE=null,STORE_NAME="addresses",DB=null,DB_NAME="convista_maps_addresses",ALL_ADDRESSES=null,DEFAULT_LATITUDE=50.938405,DEFAULT_LONGITUDE=6.953648,meta_data=null,runtime_data=null,saveAddressDimension=null,saveTextDimension=null,saveKeyFigureName1=null,saveKeyFigureName1Diff=null,saveKeyFigureName2Diff=null,saveKeyFigureName1ClusterSteps=null,saveKeyFigureName2ClusterSteps=null,saveKeyFigureTolerance=null,saveDateDimension=null,saveAPIKey=null,saveApiLoad=null,addressData=null,clusterSelectionData=null,addressSelectionData=null,dateSelectionData=null,idSelectionData=null,keyFigureToDisplayData=null,keyfigureButtonClicked=null,that=this,initialize=!0,keyfigureFormatStrings={};this.init=function(){ALL_ADDRESSES=[]},this.beforeUpdate=function(){},this.afterUpdate=function(){if(null!==runtime_data&&runtime_data.changed===!0&&initialize===!1){runtime_data.changed=!1;for(var notif_position_in_dimensions_array=0,iter_step=0,l=0;l<runtime_data.dimensions.length;l++)dim=runtime_data.dimensions[l],dim.containsMeasures===!0?iter_step=dim.members.length:dim.key===saveTextDimension&&(notif_position_in_dimensions_array=l);for(var tuples_grouped_by_rowKey=[],i=0,current_row_key_index=runtime_data.tuples[0][notif_position_in_dimensions_array],current_tuples_to_group=new Array;i<runtime_data.tuples.length;){var tuple=runtime_data.tuples[i];if(tuple[notif_position_in_dimensions_array]===current_row_key_index){var row=runtime_data.dimensions[1].members[tuple[1]].type;"RESULT"!==row&&current_tuples_to_group.push(tuple)}else tuples_grouped_by_rowKey.push(current_tuples_to_group),current_tuples_to_group=new Array,current_tuples_to_group.push(tuple),current_row_key_index=tuple[notif_position_in_dimensions_array];i===runtime_data.tuples.length-1&&tuples_grouped_by_rowKey.push(current_tuples_to_group),i++}var dim=null,address=null,marker_text=null,date=null,id_array=[],address_array=[],text_array=[],date_array=[],layers_redraw_array=[],keyfigure_updated=[],keyfigure2_array=[],keyfigure2=0,keyfigure1_array=[],keyfigure1=0,keyfigure2_array_diff=[],keyfigure2_diff=0,keyfigure1_array_diff=[],keyfigure1_diff=0,data_pointer=-iter_step;if(tuples_grouped_by_rowKey){for(var l=0;l<tuples_grouped_by_rowKey.length;l++){for(var id=0,i=0;i<tuples_grouped_by_rowKey[l].length;i+=iter_step){var tuple=tuples_grouped_by_rowKey[l][i];data_pointer+=iter_step;for(var j=0;j<tuple.length;j++)if(dim=runtime_data.dimensions[j],dim.key===saveTextDimension&&(id=dim.members[tuple[j]].key,marker_text=dim.members[tuple[j]].text),dim.key===saveAddressDimension)address=dim.members[tuple[j]].text;else if(dim.key===saveDateDimension)date=dim.members[tuple[j]].text;else if(dim.containsMeasures===!0)for(var k=0;k<dim.members.length;k++){var index=data_pointer+k,data_init="";dim.members[k].text===saveKeyFigureName1?null===runtime_data.data[index]||""===runtime_data.data[index]?(data_init=isFloat(keyfigureFormatStrings.figure1)?parseFloat("0.00").toFixed(4):"0",keyfigure1_array.push(data_init)):keyfigure1_array.push(runtime_data.data[index]):dim.members[k].text===saveKeyFigureName2?null===runtime_data.data[index]||""===runtime_data.data[index]?(data_init=isFloat(keyfigureFormatStrings.figure2)?parseFloat("0.00").toFixed(4):"0",keyfigure2_array.push(data_init)):keyfigure2_array.push(runtime_data.data[index]):dim.members[k].text===saveKeyFigureName1Diff?null===runtime_data.data[index]||""===runtime_data.data[index]?(data_init=isFloat(keyfigureFormatStrings.figure1)?parseFloat("0.00").toFixed(4):"0",keyfigure1_array_diff.push(data_init)):keyfigure1_array_diff.push(runtime_data.data[index]):dim.members[k].text===saveKeyFigureName2Diff&&(null===runtime_data.data[index]||""===runtime_data.data[index]?(data_init=isFloat(keyfigureFormatStrings.figure2)?parseFloat("0.00").toFixed(4):"0",keyfigure2_array_diff.push(data_init)):keyfigure2_array_diff.push(runtime_data.data[index]))}}id_array.push(id),address_array.push(address),text_array.push(marker_text),date_array.push(date);for(var m=0;m<keyfigure1_array.length;m++)isInt(keyfigureFormatStrings.figure1)?(keyfigure1+=parseInt(keyfigure1_array[m],10),keyfigure1_diff+=parseInt(keyfigure1_array_diff[m],10)):(keyfigure1+=parseFloat(keyfigure1_array[m]),keyfigure1_diff+=parseFloat(keyfigure1_array_diff[m])),isInt(keyfigureFormatStrings.figure2)?(keyfigure2+=parseInt(keyfigure2_array[m],10),keyfigure2_diff+=parseInt(keyfigure2_array_diff[m],10)):(keyfigure2+=parseFloat(keyfigure2_array[m]),keyfigure2_diff+=parseFloat(keyfigure2_array_diff[m]));keyfigure_updated[l]=[keyfigure1,keyfigure2,keyfigure1_diff,keyfigure2_diff],keyfigure1_array=[],keyfigure2_array=[],keyfigure1_array_diff=[],keyfigure2_array_diff=[],keyfigure1=0,keyfigure2=0,keyfigure1_diff=0,keyfigure2_diff=0}for(var i=0;i<id_array.length;i++){for(var marker_updated=!1,j=0;j<that.markersArray.length;j++)if(that.markersArray[j].id===id_array[i]){isFloat(keyfigure_updated[i][0])&&(keyfigure_updated[i][0]=parseFloat(keyfigure_updated[i][0]).toFixed(2)),isFloat(keyfigure_updated[i][1])&&(keyfigure_updated[i][1]=parseFloat(keyfigure_updated[i][1]).toFixed(2)),that.markersArray[j].keyfigure1=keyfigure_updated[i][0],that.markersArray[j].diff1=keyfigure_updated[i][2],that.markersArray[j].keyfigure2=keyfigure_updated[i][1],that.markersArray[j].diff2=keyfigure_updated[i][3],layers_redraw_array.push(that.markersArray[j]),marker_updated=!0;break}if(marker_updated===!1){var doc=findInAddressDatabase(address_array[i]);if(null!==doc&&void 0!==doc){var loc=[doc.geometry.coordinates[0],doc.geometry.coordinates[1]],marker=createMarker(address_array[i],keyfigure_updated[i],text_array[i],loc,date_array[i],id_array[i]);layers_redraw_array.push(marker)}}}that.markerClusterer.clearLayers(),that.markerClusterer.addLayers(layers_redraw_array),keyfigure_updated=[],id_array=[]}else alert("Chosen dataset is empty.")}initialize===!0&&(null!==DB_URL&&void 0!==DB_URL&&""!==DB_URL?($.ajax({type:"GET",url:DB_URL+DB_URL_EXTENSION,async:!1,contentType:"application/json",success:function(json){for(var rows=JSON.parse(json).rows,i=0;i<rows.length;i++)ALL_ADDRESSES.push(rows[i].doc)},error:function(e){window.console&&console.log(e.statusText)}}),initMap(function(){initData(),that.map.invalidateSize(!1)}),initialize=!1):(openAddressDatabase(function(){getAllItems(function(){initMap(function(){initData(),that.map.invalidateSize(!1)})})}),initialize=!1))},this.componentDeleted=function(){},this.metadata=function(value){return void 0===value?meta_data:(meta_data=value,this)},this.runtimedata=function(value){return void 0===value?runtime_data:(null!==runtime_data&&""!==runtime_data&&void 0!==runtime_data.tuples&&void 0!==value.tuples&&runtime_data.tuples.length!==value.tuples.length?(runtime_data=value,runtime_data.changed=!0):(runtime_data=value,runtime_data.changed=!1),this)},this.apikey=function(value){return void 0===value?saveAPIKey:(saveAPIKey=value,this)},this.databaseaddress=function(value){return void 0===value?DB_URL:(DB_URL=value,this)},this.databaseaddressextension=function(value){return void 0===value?DB_URL_EXTENSION:(DB_URL_EXTENSION=value,this)},this.address=function(value){return void 0===value?addressData:(addressData=value,this)},this.clusterselection=function(value){return void 0===value?clusterSelectionData:(clusterSelectionData=value,this)},this.addressselection=function(value){return void 0===value?addressSelectionData:(addressSelectionData=value,this)},this.dateselection=function(value){return void 0===value?dateSelectionData:(dateSelectionData=value,this)},this.idselection=function(value){return void 0===value?idSelectionData:(idSelectionData=value,this)},this.addressdimension=function(value){return void 0===value?saveAddressDimension:(saveAddressDimension=value,this)},this.textdimension=function(value){return void 0===value?saveTextDimension:(saveTextDimension=value,this)},this.datedimension=function(value){return void 0===value?saveDateDimension:(saveDateDimension=value,this)},this.keyfigurename1=function(value){return void 0===value?saveKeyFigureName1:(saveKeyFigureName1=value,this)},this.keyfigurename1diff=function(value){return void 0===value?saveKeyFigureName1Diff:(saveKeyFigureName1Diff=value,this)},this.keyfigurename1clustersteps=function(value){if(void 0===value)return saveKeyFigureName1ClusterSteps;try{saveKeyFigureName1ClusterSteps=JSON.parse(value)}catch(e){window.console&&console.log("invalid json for cluster steps for keyfigure1 :"+value)}return this},this.keyfigurename2=function(value){return void 0===value?saveKeyFigureName2:(saveKeyFigureName2=value,this)},this.keyfigurename2diff=function(value){return void 0===value?saveKeyFigureName2Diff:(saveKeyFigureName2Diff=value,this)},this.keyfigurename2clustersteps=function(value){if(void 0===value)return saveKeyFigureName2ClusterSteps;try{saveKeyFigureName2ClusterSteps=JSON.parse(value)}catch(e){window.console&&console.log("invalid json for cluster steps for keyfigure2 : "+value)}return this},this.keyfiguretolerance=function(value){return void 0===value?saveKeyFigureTolerance:(isFloat(value)?saveKeyFigureTolerance=value:isInt(value)?saveKeyFigureTolerance=value/100:window.console&&console.log("Wrong or missing input for keyfigure tolerance! "+value),this)},this.keyfiguretodisplay=function(value){if(void 0===value||""===value)return keyFigureToDisplayData;if(keyFigureToDisplayData!==value&&null!==keyFigureToDisplayData&&""!==keyFigureToDisplayData){value===that.keyfigurename1()?that.markerClusterer.eachLayer(function(layer){layer.updateLabelContent(""+layer.keyfigure1),layer.activeKeyfigure=0}):value===that.keyfigurename2()&&that.markerClusterer.eachLayer(function(layer){layer.updateLabelContent(""+layer.keyfigure2),layer.activeKeyfigure=1});var clusters=that.markerClusterer.getLayers();that.markerClusterer.removeLayers(that.markerClusterer.getLayers()),that.markerClusterer.addLayers(clusters)}return keyFigureToDisplayData=value,this},this.apiload=function(value){return void 0===value?saveApiLoad:void(saveApiLoad=value)}}),sap.zen.Dispatcher.instance.resumeDispatching()})}();